<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Prompt Generator | AI Valuace Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 25px 70px rgba(33, 150, 243, 0.2);
            max-width: 1200px;
            width: 100%;
            padding: 50px;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            text-decoration: none;
            color: #2196f3;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        h1 {
            color: #1565c0;
            font-size: 32px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 700;
        }

        .subtitle {
            color: #42a5f5;
            text-align: center;
            margin-bottom: 50px;
            font-size: 15px;
            font-weight: 500;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.1);
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
        }

        .step.active {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
        }

        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(33, 150, 243, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }

        .step.active .step-number {
            background: rgba(255, 255, 255, 0.3);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .property-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .property-card {
            background: white;
            border: 3px solid #e3f2fd;
            border-radius: 16px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .property-card[onclick*="land"] {
            background: linear-gradient(135deg, rgba(102, 187, 106, 0.08) 0%, rgba(67, 160, 71, 0.12) 100%);
            border-color: rgba(102, 187, 106, 0.3);
        }

        .property-card[onclick*="apartment"] {
            background: linear-gradient(135deg, rgba(66, 165, 245, 0.08) 0%, rgba(30, 136, 229, 0.12) 100%);
            border-color: rgba(66, 165, 245, 0.3);
        }

        .property-card[onclick*="house"] {
            background: linear-gradient(135deg, rgba(255, 167, 38, 0.08) 0%, rgba(251, 140, 0, 0.12) 100%);
            border-color: rgba(255, 167, 38, 0.3);
        }

        .property-card[onclick*="commercial"] {
            background: linear-gradient(135deg, rgba(171, 71, 188, 0.08) 0%, rgba(142, 36, 170, 0.12) 100%);
            border-color: rgba(171, 71, 188, 0.3);
        }

        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(33, 150, 243, 0.2);
        }

        .property-card[onclick*="land"]:hover {
            border-color: #66bb6a;
            box-shadow: 0 8px 24px rgba(102, 187, 106, 0.25);
        }

        .property-card[onclick*="apartment"]:hover {
            border-color: #42a5f5;
            box-shadow: 0 8px 24px rgba(66, 165, 245, 0.25);
        }

        .property-card[onclick*="house"]:hover {
            border-color: #ffa726;
            box-shadow: 0 8px 24px rgba(255, 167, 38, 0.25);
        }

        .property-card[onclick*="commercial"]:hover {
            border-color: #ab47bc;
            box-shadow: 0 8px 24px rgba(171, 71, 188, 0.25);
        }

        .property-card.selected {
            border-width: 3px;
        }

        .property-card[onclick*="land"].selected {
            background: linear-gradient(135deg, rgba(102, 187, 106, 0.15) 0%, rgba(67, 160, 71, 0.2) 100%);
            border-color: #66bb6a;
            box-shadow: 0 8px 24px rgba(102, 187, 106, 0.3);
        }

        .property-card[onclick*="apartment"].selected {
            background: linear-gradient(135deg, rgba(66, 165, 245, 0.15) 0%, rgba(30, 136, 229, 0.2) 100%);
            border-color: #42a5f5;
            box-shadow: 0 8px 24px rgba(66, 165, 245, 0.3);
        }

        .property-card[onclick*="house"].selected {
            background: linear-gradient(135deg, rgba(255, 167, 38, 0.15) 0%, rgba(251, 140, 0, 0.2) 100%);
            border-color: #ffa726;
            box-shadow: 0 8px 24px rgba(255, 167, 38, 0.3);
        }

        .property-card[onclick*="commercial"].selected {
            background: linear-gradient(135deg, rgba(171, 71, 188, 0.15) 0%, rgba(142, 36, 170, 0.2) 100%);
            border-color: #ab47bc;
            box-shadow: 0 8px 24px rgba(171, 71, 188, 0.3);
        }

        .property-card.selected::after {
            content: "✓";
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .property-card h3 {
            color: #1e293b;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .property-card p {
            color: #64748b;
            font-size: 13px;
        }

        .inputs-section h3 {
            color: #1565c0;
            font-size: 22px;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .checkbox-item {
            background: white;
            border: 2px solid #e3f2fd;
            border-radius: 12px;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-item:hover {
            border-color: #2196f3;
            background: rgba(33, 150, 243, 0.05);
        }

        .checkbox-item.checked {
            border-color: #2196f3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.05) 0%, rgba(25, 118, 210, 0.1) 100%);
        }

        .checkbox-item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #2196f3;
        }

        .checkbox-item label {
            font-weight: 600;
            color: #1e293b;
            cursor: pointer;
            flex-grow: 1;
            font-size: 15px;
        }

        .checkbox-item .icon {
            font-size: 18px;
            color: #2196f3;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            color: #1e293b;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e3f2fd;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group small {
            color: #64748b;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 35px;
        }

        .btn {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #2196f3;
            border: 2px solid #2196f3;
        }

        .btn-secondary:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-section {
            background: linear-gradient(135deg, rgba(227, 242, 253, 0.5) 0%, rgba(255, 255, 255, 0.8) 100%);
            border-radius: 20px;
            padding: 35px;
            margin-top: 35px;
            border: 2px solid rgba(33, 150, 243, 0.1);
        }

        .result-section h2 {
            color: #1565c0;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .prompt-output {
            background: white;
            border: 2px solid #e3f2fd;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
        }

        .prompt-text {
            font-family: 'Courier New', monospace;
            color: #1e293b;
            line-height: 1.8;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .copy-btn.copied {
            background: #10b981;
        }

        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
            padding: 18px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            color: #1565c0;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.6;
        }

        /* Modal/Pop-up styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .modal-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
        }

        .modal-title {
            color: #1e293b;
            font-size: 20px;
            font-weight: 700;
        }

        .modal-body {
            color: #475569;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-list {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .modal-list-item {
            color: #991b1b;
            font-weight: 600;
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-list-item:before {
            content: "•";
            color: #ef4444;
            font-size: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }

        .modal-btn {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.4);
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }

            .step-indicator {
                flex-direction: column;
                gap: 10px;
            }

            .property-type-grid {
                grid-template-columns: 1fr;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .buttons {
                flex-direction: column;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="javascript:void(0)" class="back-btn" id="topBackBtn" onclick="handleTopBackButton()">← Zpět</a>
        
        <h1>R-E Prompt Generator</h1>
        <p class="subtitle">Profesionální AI valuace pro zástavní financování</p>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <span>Typ</span>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <span>Dokumenty</span>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <span>Údaje</span>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <span>Prompt</span>
            </div>
        </div>

        <!-- STEP 1 -->
        <div class="section active" id="step1">
            <div class="property-type-grid">
                <div class="property-card" onclick="selectPropertyType('land')">
                    <h3>Pozemek</h3>
                    <p>Stavební parcela nebo developerský projekt</p>
                </div>
                <div class="property-card" onclick="selectPropertyType('apartment')">
                    <h3>Byt</h3>
                    <p>Bytová jednotka</p>
                </div>
                <div class="property-card" onclick="selectPropertyType('house')">
                    <h3>Rodinný dům</h3>
                    <p>Samostatný dům s pozemkem</p>
                </div>
                <div class="property-card" onclick="selectPropertyType('commercial')">
                    <h3>Komerční objekt</h3>
                    <p>Kanceláře, sklady, retail</p>
                </div>
            </div>
            <div class="buttons">
                <button class="btn btn-primary" onclick="nextStep()" id="step1Next" disabled>Pokračovat →</button>
            </div>
        </div>

        <!-- STEP 2 -->
        <div class="section" id="step2">
            <div class="inputs-section">
                <h3>Dokumenty k nahrání:</h3>
                <div class="checkbox-grid" id="inputsGrid"></div>
                <div class="info-box">
                    <strong>Tyto dokumenty nahrajete do AI agenta.</strong> Agent zmíní v promptu, že mu posíláte vybrané dokumenty (např. "nahrávám ti znalecký posudek"). Čím více dokumentů, tím přesnější ocenění.
                </div>
            </div>
            <div class="buttons">
                <button class="btn btn-secondary" onclick="prevStep()">← Zpět</button>
                <button class="btn btn-primary" onclick="nextStep()">Pokračovat →</button>
            </div>
        </div>

        <!-- STEP 3 -->
        <div class="section" id="step3">
            <div class="inputs-section">
                <h3>Vyplňte dostupné údaje:</h3>
                <div id="detailForm"></div>
            </div>
            <div class="buttons">
                <button class="btn btn-secondary" onclick="prevStep()">← Zpět</button>
                <button class="btn btn-primary" onclick="generatePrompt()">Vygenerovat AI Prompt →</button>
            </div>
        </div>

        <!-- STEP 4 -->
        <div class="section" id="step4">
            <div class="result-section">
                <h2>AI Prompt pro bankovní valuaci</h2>
                
                <div class="info-box">
                    <strong>Návod:</strong> Zkopírujte tento prompt a vložte ho do ChatGPT, Claude nebo Gemini. AI vám poskytne profesionální ocenění včetně zástavní hodnoty pro dluhové financování.
                </div>

                <div class="prompt-output">
                    <button class="copy-btn" onclick="copyPrompt()">Kopírovat</button>
                    <div class="prompt-text" id="promptText"></div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn btn-secondary" onclick="resetGenerator()">Nová valuace</button>
                <button class="btn btn-primary" onclick="window.location.href='index.html'">← Hlavní stránka</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let propertyType = '';
        let selectedInputs = [];
        let formData = {};

        const propertyConfigs = {
            land: {
                name: 'Pozemek',
                inputs: [
                    { id: 'znalecky_posudek', label: 'Znalecký posudek', icon: '▪' },
                    { id: 'lv', label: 'List vlastnictví (LV)', icon: '▪' },
                    { id: 'vypis_KN', label: 'Výpis z katastru nemovitostí', icon: '▪' },
                    { id: 'uzemni_plan', label: 'Územní plán / Metropolitní plán', icon: '▪' },
                    { id: 'fotografie', label: 'Fotografie pozemku', icon: '▪' },
                    { id: 'studie_projektu', label: 'Studie/Projekt záměru', icon: '▪' },
                    { id: 'stavebni_povoleni', label: 'Stavební povolení', icon: '▪' },
                    { id: 'uzemni_rozhodnuti', label: 'Územní rozhodnutí', icon: '▪' }
                ],
                fields: {
                    parcelni_cislo: { type: 'text', label: 'Parcelní číslo *', placeholder: 'např. 123/45', required: true },
                    katastralni_uzemi: { type: 'text', label: 'Katastrální území *', placeholder: 'např. Černošice', required: true },
                    plocha: { type: 'number', label: 'Výměra pozemku (m²) *', placeholder: 'např. 2500', required: true },
                    developer_projekt: { type: 'select', label: 'Developerský projekt *', options: ['Ano - s projektem', 'Ano - se studií', 'Plánovaný', 'Ne'], required: true },
                    dodatecne_info: { type: 'textarea', label: 'Dodatečné informace o projektu/pozemku', placeholder: 'KZP, KPP, výšková hladina, inženýrské sítě, přístup k pozemku, počet plánovaných jednotek, očekávané GDV, fáze projektu, podmínky výstavby, územní studie, věcná břemena, časový harmonogram...' }
                }
            },
            apartment: {
                name: 'Byt',
                inputs: [
                    { id: 'znalecky_posudek', label: 'Znalecký posudek', icon: '▪' },
                    { id: 'lv', label: 'List vlastnictví (LV)', icon: '▪' },
                    { id: 'vypis_KN', label: 'Výpis z katastru nemovitostí', icon: '▪' },
                    { id: 'fotografie', label: 'Fotografie bytu', icon: '▪' },
                    { id: 'pudorys', label: 'Půdorys', icon: '▪' },
                    { id: 'prohlaseni_vlastnika', label: 'Prohlášení vlastníka budovy', icon: '▪' },
                    { id: 'najemni_smlouva', label: 'Nájemní smlouva (pokud je)', icon: '▪' },
                    { id: 'penb', label: 'Energetický štítek (PENB)', icon: '▪' }
                ],
                fields: {
                    adresa: { type: 'text', label: 'Přesná adresa *', placeholder: 'např. Pařížská 123, Praha 1', required: true },
                    uzitna_plocha: { type: 'number', label: 'Užitná plocha (m²) *', placeholder: 'např. 75', required: true },
                    stav: { type: 'select', label: 'Stav bytu *', options: ['Výborný', 'Velmi dobrý', 'Dobrý', 'Průměrný', 'Před rekonstrukcí', 'Nutná rekonstrukce'], required: true },
                    podlazi: { type: 'text', label: 'Podlaží (dodatečné)', placeholder: 'např. 3. patro z 5' },
                    rok_stavby: { type: 'number', label: 'Rok stavby budovy (dodatečné)', placeholder: 'např. 1998' },
                    balkon_terasa: { type: 'number', label: 'Plocha balkonu/terasy (m²) - dodatečné', placeholder: 'např. 8' },
                    sklep: { type: 'number', label: 'Plocha sklepa (m²) - dodatečné', placeholder: 'např. 4' },
                    parking: { type: 'select', label: 'Parkování (dodatečné)', options: ['Ano - garáž', 'Ano - venkovní stání', 'Ne'] },
                    vyuz: { type: 'text', label: 'Současné využití (dodatečné)', placeholder: 'např. vlastní bydlení, pronájem' },
                    najemne: { type: 'number', label: 'Měsíční nájemné (Kč) - dodatečné', placeholder: 'např. 18000' },
                    dodatecne_info: { type: 'textarea', label: 'Další dodatečné informace', placeholder: 'Výtah, orientace, rekonstrukce, věcná břemena, právní vady...' }
                }
            },
            house: {
                name: 'Rodinný dům',
                inputs: [
                    { id: 'znalecky_posudek', label: 'Znalecký posudek', icon: '▪' },
                    { id: 'lv', label: 'List vlastnictví (LV)', icon: '▪' },
                    { id: 'vypis_KN', label: 'Výpis z katastru nemovitostí', icon: '▪' },
                    { id: 'fotografie', label: 'Fotografie domu', icon: '▪' },
                    { id: 'pudorys', label: 'Půdorysy', icon: '▪' },
                    { id: 'stavebni_povoleni', label: 'Kolaudační rozhodnutí', icon: '▪' },
                    { id: 'najemni_smlouva', label: 'Nájemní smlouva (pokud je)', icon: '▪' },
                    { id: 'projektova_dokumentace', label: 'Projektová dokumentace', icon: '▪' }
                ],
                fields: {
                    adresa: { type: 'text', label: 'Adresa *', placeholder: 'např. Zahradní 45, Černošice', required: true },
                    uzitna_plocha: { type: 'number', label: 'Užitná plocha domu (m²) *', placeholder: 'např. 150', required: true },
                    plocha_pozemku: { type: 'number', label: 'Plocha pozemku (m²) *', placeholder: 'např. 800', required: true },
                    stav: { type: 'select', label: 'Stav domu *', options: ['Výborný - nový', 'Velmi dobrý', 'Dobrý', 'Průměrný', 'Před rekonstrukcí', 'Nutná rekonstrukce'], required: true },
                    podlazi: { type: 'text', label: 'Počet podlaží (dodatečné)', placeholder: 'např. 2 NP + půda' },
                    rok_stavby: { type: 'number', label: 'Rok stavby/rekonstrukce (dodatečné)', placeholder: 'např. 2005' },
                    parking: { type: 'select', label: 'Garáž/Parkování (dodatečné)', options: ['Ano - v domě', 'Ano - samostatná garáž', 'Venkovní stání', 'Ne'] },
                    vyuz: { type: 'text', label: 'Současné využití (dodatečné)', placeholder: 'např. rodinné bydlení' },
                    najemne: { type: 'number', label: 'Měsíční nájemné (Kč) - dodatečné', placeholder: 'např. 35000' },
                    dodatecne_info: { type: 'textarea', label: 'Další dodatečné informace', placeholder: 'Přístavby, bazén, technické vybavení, věcná břemena...' }
                }
            },
            commercial: {
                name: 'Komerční objekt',
                inputs: [
                    { id: 'znalecky_posudek', label: 'Znalecký posudek', icon: '▪' },
                    { id: 'lv', label: 'List vlastnictví (LV)', icon: '▪' },
                    { id: 'vypis_KN', label: 'Výpis z katastru nemovitostí', icon: '▪' },
                    { id: 'najemni_smlouvy', label: 'Nájemní smlouvy (aktivní)', icon: '▪' },
                    { id: 'rent_roll', label: 'Rent Roll (přehled nájemníků)', icon: '▪' },
                    { id: 'financni_vysledky', label: 'Finanční výsledky (VZZ, Rozvaha)', icon: '▪' },
                    { id: 'fotografie', label: 'Fotografie objektu', icon: '▪' },
                    { id: 'plan_udrzby', label: 'OpEx/CapEx', icon: '▪' }
                ],
                fields: {
                    adresa: { type: 'text', label: 'Adresa *', placeholder: 'např. Průmyslová 789, Praha 10', required: true },
                    typ_objektu: { type: 'select', label: 'Typ objektu *', options: ['Kanceláře', 'Obchod/Retail', 'Sklady/Logistika', 'Výroba', 'Hotel', 'Smíšené využití'], required: true },
                    stav: { type: 'select', label: 'Stav objektu *', options: ['Výborný', 'Velmi dobrý', 'Dobrý', 'Průměrný', 'Nutná renovace'], required: true },
                    pronajimatelna_plocha: { type: 'number', label: 'Pronajímatelná plocha (m²) - dodatečné', placeholder: 'např. 500' },
                    obsazenost: { type: 'number', label: 'Aktuální obsazenost (%) - dodatečné', placeholder: 'např. 85' },
                    najemne_rocni_odhad: { type: 'number', label: 'Odhad ročního nájemného při 100% obsazenosti (Kč) - dodatečné', placeholder: 'např. 1500000' },
                    rok_stavby: { type: 'number', label: 'Rok stavby/rekonstrukce - dodatečné', placeholder: 'např. 2010' },
                    dodatecne_info: { type: 'textarea', label: 'Další dodatečné informace', placeholder: 'Kvalita nájemníků, délka smluv, provozní náklady, plánované investice (CapEx)...' }
                }
            }
        };

        function selectPropertyType(type) {
            propertyType = type;
            document.querySelectorAll('.property-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            document.getElementById('step1Next').disabled = false;
        }

        function handleTopBackButton() {
            if (currentStep === 1) {
                // Pokud jsme na Step 1, jdi na hlavní stránku
                window.location.href = 'index.html';
            } else {
                // Jinak jdi o krok zpět
                prevStep();
            }
        }

        function nextStep() {
            if (currentStep === 1 && !propertyType) return;
            
            if (currentStep === 2) populateDetailForm();
            
            currentStep++;
            updateStepIndicator();
            showSection(currentStep);
        }

        function showMissingFieldsModal(missingFields) {
            const listContainer = document.getElementById('missingFieldsList');
            listContainer.innerHTML = missingFields.map(field => 
                `<div class="modal-list-item">${field}</div>`
            ).join('');
            
            document.getElementById('requiredFieldsModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('requiredFieldsModal').classList.remove('active');
        }

        // Zavřít modal při kliknutí mimo obsah
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('requiredFieldsModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        function prevStep() {
            currentStep--;
            updateStepIndicator();
            showSection(currentStep);
        }

        function updateStepIndicator() {
            document.querySelectorAll('.step').forEach((step, index) => {
                if (index + 1 <= currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        function showSection(step) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('step' + step).classList.add('active');
            if (step === 2) populateInputsGrid();
        }

        function populateInputsGrid() {
            const grid = document.getElementById('inputsGrid');
            const config = propertyConfigs[propertyType];
            grid.innerHTML = config.inputs.map(input => `
                <div class="checkbox-item" onclick="toggleInput('${input.id}', this)">
                    <input type="checkbox" id="${input.id}" onchange="toggleInput('${input.id}', this.parentElement)">
                    <span class="icon">${input.icon}</span>
                    <label for="${input.id}">${input.label}</label>
                </div>
            `).join('');
        }

        function toggleInput(inputId, element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
                element.classList.add('checked');
                if (!selectedInputs.includes(inputId)) selectedInputs.push(inputId);
            } else {
                element.classList.remove('checked');
                selectedInputs = selectedInputs.filter(id => id !== inputId);
            }
        }

        function populateDetailForm() {
            const form = document.getElementById('detailForm');
            const config = propertyConfigs[propertyType];
            let html = '';
            for (const [fieldId, field] of Object.entries(config.fields)) {
                if (fieldId === 'najemne' && !selectedInputs.includes('najemni_smlouva') && !selectedInputs.includes('najemni_smlouvy')) continue;
                html += '<div class="form-group">';
                html += `<label for="${fieldId}">${field.label}</label>`;
                if (field.type === 'textarea') {
                    html += `<textarea id="${fieldId}" placeholder="${field.placeholder || ''}"></textarea>`;
                } else if (field.type === 'select') {
                    html += `<select id="${fieldId}"><option value="">-- Vyberte --</option>`;
                    field.options.forEach(opt => html += `<option value="${opt}">${opt}</option>`);
                    html += '</select>';
                } else {
                    html += `<input type="${field.type}" id="${fieldId}" placeholder="${field.placeholder || ''}">`;
                }
                html += '</div>';
            }
            form.innerHTML = html;
        }

        function generatePrompt() {
            const config = propertyConfigs[propertyType];
            
            // Sbírání dat z formuláře
            formData = {};
            for (const fieldId of Object.keys(config.fields)) {
                const element = document.getElementById(fieldId);
                if (element && element.value) formData[fieldId] = element.value;
            }
            
            // Validace povinných polí
            let missingFields = [];
            for (const [key, field] of Object.entries(config.fields)) {
                if (field.required && !formData[key]) {
                    missingFields.push(field.label.replace(' *', ''));
                }
            }
            
            if (missingFields.length > 0) {
                showMissingFieldsModal(missingFields);
                return;
            }
            
            // Vygenerování promptu
            const prompt = buildPrompt();
            document.getElementById('promptText').textContent = prompt;
            
            // Přechod na další krok
            currentStep++;
            updateStepIndicator();
            showSection(currentStep);
        }

        function buildPrompt() {
            const config = propertyConfigs[propertyType];
            let prompt = `# MASTER PROMPT: AI VALUACE NEMOVITOSTI PRO BANKOVNÍ ZAJIŠTĚNÍ\n\n`;
            prompt += `## ROLE A KONTEXT\n`;
            prompt += `Jsi seniorní bankovní supervizor pro oceňování nemovitostí (Collateral Risk Manager) v České republice. Máš hlubokou znalost:\n`;
            prompt += `- Zákona č. 151/1997 Sb. o oceňování majetku\n`;
            prompt += `- Zákona č. 190/2004 Sb. o dluhopisech (§ 29 - zástavní hodnota)\n`;
            prompt += `- Mezinárodních standardů IVS/EVS\n\n`;
            prompt += `Tvá povaha je **skeptická, konzervativní a zaměřená na identifikaci rizik**. Při oceňování postupuješ podle principu opatrnosti.\n\n`;
            
            prompt += `## CÍL OCENĚNÍ\n`;
            prompt += `Analyzovat nemovitost a stanovit:\n`;
            prompt += `1. **Tržní hodnotu** (Market Value) - nejpravděpodobnější cena při prodeji. Nejdůležitější výstup výzkumu.\n`;
            prompt += `2. **Zástavní hodnotu** (Collateral Value) - konzervativní hodnota pro účely bankovního zajištění (LTV)\n`;
            prompt += `3. **Identifikaci rizik** (Red Flags) - právní vady, technické problémy, tržní rizika\n\n`;

            prompt += `## TYP NEMOVITOSTI\n`;
            prompt += `**${config.name}**\n\n`;

            if (selectedInputs.length > 0) {
                prompt += `## NAHRANÉ DOKUMENTY\n`;
                prompt += `Nahrávám ti následující dokumenty, které ti pomohou s přesným oceněním:\n`;
                selectedInputs.forEach(inputId => {
                    const input = config.inputs.find(i => i.id === inputId);
                    if (input) prompt += `- ${input.label}\n`;
                });
                prompt += `\nPoužij tyto dokumenty pro ověření údajů a zpřesnění ocenění.\n\n`;
            }

            prompt += `## ÚDAJE O NEMOVITOSTI\n`;
            for (const [key, value] of Object.entries(formData)) {
                const field = config.fields[key];
                if (field && value) prompt += `- **${field.label}**: ${value}\n`;
            }
            prompt += `\n`;

            // Specifické instrukce podle typu
            if (propertyType === 'land') {
                prompt += `## METODIKA OCENĚNÍ POZEMKU\n\n`;
                
                prompt += `### KROK 0: ZJIŠTĚNÍ ZÁKLADNÍCH ÚDAJŮ O POZEMKU\n`;
                prompt += `**POVINNÝ ÚKOL**: Na základě parcelního čísla a katastrálního území:\n`;
                prompt += `1. Zjisti **druh pozemku** z katastru nemovitostí (Stavební parcela, Orná půda, Zahrada, Les, Ostatní plocha)\n`;
                prompt += `2. Zjisti **účel využití** podle Územního plánu a Metropolitního plánu:\n`;
                prompt += `   - Pro Prahu: použij Metropolitní plán (IPR Praha)\n`;
                prompt += `   - Pro ostatní města: použij Územní plán obce\n`;
                prompt += `3. Zjisti **KZP** (Koeficient zastavěné plochy), **KPP** (Koeficient podlažních ploch) a **výškovou hladinu**\n`;
                prompt += `4. Zjisti **přístup k inženýrským sítím** (elektřina, voda, kanalizace, plyn)\n`;
                prompt += `5. Ověř **přístupovou cestu** k pozemku\n\n`;
                prompt += `Tyto informace jsou **klíčové** pro správné ocenění!\n\n`;
                
                if (formData.developer_projekt && formData.developer_projekt.includes('Ano')) {
                    prompt += `### 1. REZIDUÁLNÍ METODA (Primární u developerských projektů)\n`;
                    prompt += `**KRITICKÉ**: Tento pozemek je určen pro developerský projekt. Proveď reverzní kalkulaci:\n\n`;
                    prompt += `**Krok 1 - Gross Development Value (GDV)**:\n`;
                    prompt += `- Odhadni prodejní ceny jednotek (byty/domy) na základě aktuálního trhu v lokalitě\n`;
                    prompt += `- Celková prodejní cena = Počet jednotek × Průměrná cena za jednotku\n`;
                    if (formData.gdv_ocekavane) {
                        prompt += `- Uživatel uvádí očekávanou GDV: ${formData.gdv_ocekavane} Kč\n`;
                        prompt += `- OVĚŘ, zda tato hodnota odpovídá tržním cenám v lokalitě!\n`;
                    }
                    prompt += `\n**Krok 2 - Stavební náklady (Hard Costs)**:\n`;
                    prompt += `- Použij aktuální stavební náklady (2026): minimálně 45.000 Kč/m² pro bytovou výstavbu\n`;
                    prompt += `- Celkem = HPP (hrubá podlažní plocha) × Jednotkové náklady\n\n`;
                    prompt += `**Krok 3 - Vedlejší náklady (Soft Costs)**:\n`;
                    prompt += `- Projektová dokumentace, inženýring, marketing, právní služby\n`;
                    prompt += `- Standardně 10-15% z Hard Costs\n\n`;
                    prompt += `**Krok 4 - Finanční náklady**:\n`;
                    prompt += `- Úroky z úvěru po dobu výstavby\n`;
                    prompt += `- Při sazbách 5-6% p.a. a době výstavby 18-24 měsíců\n\n`;
                    prompt += `**Krok 5 - Marže developera (Developer's Profit)**:\n`;
                    prompt += `- KRITICKÉ: Požadovaný zisk musí být minimálně 15-20% z celkových nákladů\n`;
                    prompt += `- Pokud je zisk nižší, projekt je **nestabilní** a představuje riziko pro věřitele\n\n`;
                    prompt += `**Krok 6 - Výpočet reziduální hodnoty pozemku**:\n`;
                    prompt += `Hodnota pozemku = GDV - (Hard Costs + Soft Costs + Finanční náklady + Marže developera)\n\n`;
                    prompt += `**STRESS TEST**: Proveď citlivostní analýzu:\n`;
                    prompt += `- Co se stane, pokud klesne prodejní cena o 10%?\n`;
                    prompt += `- Co se stane, pokud vzrostou stavební náklady o 15%?\n`;
                    prompt += `- Je projekt stále rentabilní?\n\n`;
                }

                prompt += `### 2. POROVNÁVACÍ METODA\n`;
                prompt += `- **Najdi minimálně 10 srovnatelných pozemků v lokalitě** (prodaných v posledních 12-24 měsících)\n`;
                prompt += `- Větší vzorek = vyšší statistická přesnost ocenění\n`;
                prompt += `- U porovnávacích metod jsou nejdůležitější **realizované prodeje za poslední 2 roky**\n`;
                prompt += `- Pro větší statistický vzorek lze použít i **inzerované ceny**, které však sniž\n`;
                prompt += `- Důvod: Realizované ceny jsou obvykle nižší než inzerované\n`;
                prompt += `- Aplikuj korekční koeficienty na:\n`;
                prompt += `  * Velikost pozemku\n`;
                prompt += `  * Dostupnost inženýrských sítí\n`;
                prompt += `  * Tvar a svažitost\n`;
                prompt += `  * Přístup z veřejné komunikace\n`;
                prompt += `- Výsledek: Cena za m² × Výměra pozemku\n\n`;

                prompt += `### 3. ANALÝZA ZASTAVITELNOSTI (Development Potential)\n`;
                if (formData.kzp || formData.kpp) {
                    prompt += `Z územního plánu:\n`;
                    if (formData.kzp) prompt += `- **KZP (Koeficient zastavěné plochy)**: ${formData.kzp}\n`;
                    if (formData.kpp) prompt += `- **KPP (Koeficient podlažních ploch)**: ${formData.kpp}\n`;
                    if (formData.vyskova_hladina) prompt += `- **Výšková hladina**: ${formData.vyskova_hladina}\n`;
                    prompt += `\n**VÝPOČET**:\n`;
                    if (formData.plocha && formData.kzp) {
                        prompt += `- Max. zastavěná plocha = ${formData.plocha} m² × ${formData.kzp} = ?\n`;
                    }
                    if (formData.plocha && formData.kpp) {
                        prompt += `- Max. HPP (hrubá podlažní plocha) = ${formData.plocha} m² × ${formData.kpp} = ?\n`;
                    }
                } else {
                    prompt += `**ÚKOL**: Odhadni zastavitelnost podle obvyklých regulativů pro danou lokalitu.\n`;
                }
                prompt += `\n`;

                prompt += `## KRITICKÁ KONTROLA - RED FLAGS\n`;
                prompt += `**PRÁVNÍ SCREENING** (Deal Breakers):\n`;
                prompt += `1. **Věcná břemena**:\n`;
                prompt += `   - Služebnost dožití (usufruct) → FATÁLNÍ RIZIKO - nevhodná zástava!\n`;
                prompt += `   - Právo stavby ve prospěch třetí osoby → VYSOKÉ RIZIKO\n`;
                prompt += `   - Služebnost inženýrských sítí → Běžné, ale ověř rozsah\n`;
                prompt += `2. **Přístupová cesta**:\n`;
                prompt += `   - Je zajištěn přístup z veřejné komunikace?\n`;
                prompt += `   - Pokud přes soukromý pozemek → musí být věcné břemeno chůze a jízdy!\n`;
                prompt += `   - "Ústní dohoda" NENÍ dostatečná pro banku\n`;
                prompt += `3. **Územní podmínky**:\n`;
                prompt += `   - Je výstavba podmíněna "územní studií" nebo "dohodou o parcelaci"?\n`;
                prompt += `   - Takové podmínky = časové riziko (může trvat roky)\n`;
                prompt += `4. **Zástavy a exekuce**:\n`;
                prompt += `   - Existující zástavy jiných věřitelů?\n`;
                prompt += `   - Poznámky o zahájení exekuce?\n`;
                prompt += `\n`;
            }

            if (propertyType === 'apartment' || propertyType === 'house') {
                prompt += `## METODIKA OCENĚNÍ\n\n`;
                prompt += `### 1. POROVNÁVACÍ METODA (Primární)\n`;
                prompt += `- **Najdi minimálně 10 srovnatelných nemovitostí prodaných v lokalitě**\n`;
                prompt += `- Větší vzorek = vyšší statistická přesnost ocenění\n`;
                prompt += `- **U porovnávacích metod jsou nejdůležitější realizované prodeje za poslední 2 roky**\n`;
                prompt += `- Pro větší množství a přesnější statistický vzorek lze použít i **inzerované ceny, které však sniž**\n`;
                prompt += `- Důvod: Realizované ceny jsou obvykle **nižší než inzerované**\n`;
                prompt += `- **Tyto pravidla platí pro porovnávací metodu jako celek u všech typů nemovitostí**\n`;
                prompt += `- Korekce na:\n`;
                prompt += `  * Stav nemovitosti\n`;
                prompt += `  * Poloha v rámci lokality\n`;
                prompt += `  * Podlaží (u bytů)\n`;
                prompt += `  * Parkování\n`;
                prompt += `  * Orientace a výhled\n`;
                prompt += `- Výsledek: Průměrná tržní cena za m² × Užitná plocha\n\n`;

                prompt += `### 2. VALIDACE PLOCH\n`;
                prompt += `**DŮLEŽITÉ**: Rozliš mezi různými typy ploch:\n`;
                prompt += `- **Užitná plocha**: Plocha, kterou lze reálně užívat (bez zdí)\n`;
                if (formData.balkon_terasa) {
                    prompt += `- **Balkony/Terasy**: ${formData.balkon_terasa} m² - započítej pouze 50% nebo vůbec!\n`;
                }
                if (formData.sklep) {
                    prompt += `- **Sklepy**: ${formData.sklep} m² - započítej pouze 20-30%\n`;
                }
                prompt += `\nBanky **neakceptují** plnou výměru balkónů a sklepů.\n\n`;

                prompt += `### 3. VÝNOSOVÁ METODA\n`;
                if (formData.najemne) {
                    prompt += `Nemovitost je pronajímána.\n\n`;
                    prompt += `**Krok 1 - Nájemné**:\n`;
                    prompt += `- Smluvní nájemné: ${formData.najemne} Kč/měsíc\n`;
                    prompt += `- **OVĚŘ** tržní nájemné v lokalitě!\n`;
                    prompt += `- Použij **nižší** z obou hodnot (princip opatrnosti)\n`;
                    prompt += `- Roční nájemné = Měsíční × 12\n\n`;
                } else {
                    prompt += `**Pokud nemáš informace, zda je pronajímáno**:\n`;
                    prompt += `- Vypočti možný nájem podle tržních sazeb v lokalitě\n`;
                    prompt += `- Zohledni opotřebení a možnou obsazenost\n`;
                    prompt += `- Stanov cenu na základě výnosové metody\n`;
                    prompt += `- **Tyto pravidla platí pro výnosovou metodu jako celek u všech typů nemovitostí**\n\n`;
                }
                prompt += `**Krok 2 - Provozní náklady (OpEx)**:\n`;
                prompt += `- Neměřitelné služby, pojištění, daň z nemovitosti, správa\n`;
                prompt += `- Obvykle 10-25% z hrubého nájmu\n`;
                prompt += `- NOI (Net Operating Income) = Hrubý příjem - OpEx\n\n`;
                prompt += `**Krok 3 - Kapitalizace**:\n`;
                prompt += `- Použij kapitalizační míru (Yield) odpovídající lokalitě a typu\n`;
                prompt += `- Praha centrum: 4-5%, Periferie: 6-7%, Regiony: 7-9%\n`;
                prompt += `- Hodnota = NOI / Kapitalizační míra\n\n`;

                prompt += `## RED FLAGS - KONTROLA\n`;
                prompt += `1. **Technický stav**:\n`;
                if (formData.stav && formData.stav.includes('rekonstrukc')) {
                    prompt += `   - Stav označen jako "${formData.stav}"\n`;
                    prompt += `   - **SNIŽ hodnotu** o odhadované náklady na rekonstrukci!\n`;
                }
                prompt += `   - Zbývající technická životnost (pokud starší 50 let)\n`;
                prompt += `2. **Právní vady**:\n`;
                prompt += `   - Služebnosti, zástavy, exekuce\n`;
                prompt += `   - Nájemní smlouvy na dobu neurčitou (snižují likviditu)\n`;
                prompt += `3. **Lokalita**:\n`;
                prompt += `   - Likvidita trhu (jak rychle se prodá?)\n`;
                prompt += `   - Výtah (u bytů ve vyšších patrech bez výtahu = riziko)\n\n`;
            }

            if (propertyType === 'commercial') {
                prompt += `## METODIKA OCENĚNÍ KOMERČNÍCH NEMOVITOSTÍ\n\n`;
                prompt += `### 1. VÝNOSOVÁ METODA (DCF - Primární)\n`;
                prompt += `**KRITICKÉ**: Pro komerční nemovitosti je výnosová metoda dominantní!\n\n`;
                prompt += `**Použij data od CBRE**: CBRE stanovuje **prime yields** u jednotlivých typů nemovitostí v ČR a Praze.\n`;
                prompt += `Následně **yield upravíš podle**:\n`;
                prompt += `- Stavu nemovitosti\n`;
                prompt += `- Lokality (Praha vs. regiony)\n`;
                prompt += `- Technického stavu\n`;
                prompt += `- Stáří budovy\n`;
                prompt += `- Obsazenosti\n`;
                prompt += `- Kvality nájemníků\n\n`;
                if (formData.najemne_rocni_odhad) {
                    prompt += `**Krok 1 - Hrubý příjem**:\n`;
                    prompt += `- Odhad ročního nájemného při 100% obsazenosti: ${formData.najemne_rocni_odhad} Kč\n`;
                    prompt += `- **DŮLEŽITÉ**: Pro konzervativní ocenění počítej s **80% obsazeností** (běžný průměr)\n`;
                    prompt += `- Efektivní příjem = ${formData.najemne_rocni_odhad} × 0.80 = ${Math.round(formData.najemne_rocni_odhad * 0.8)} Kč\n`;
                    if (formData.obsazenost) {
                        prompt += `- Aktuální obsazenost je ${formData.obsazenost}%, zohledni to ve výpočtu\n`;
                    }
                } else {
                    prompt += `**Krok 1 - Hrubý příjem**:\n`;
                    prompt += `- Odhadni tržní nájemné pro tento typ objektu v lokalitě\n`;
                    prompt += `- **DŮLEŽITÉ**: Pro konzervativní ocenění počítej s **80% obsazeností** (běžný průměr)\n`;
                    prompt += `- Efektivní příjem = Tržní nájemné při 100% × 0.80\n`;
                }
                prompt += `\n**Krok 2 - Provozní náklady (OpEx)**:\n`;
                prompt += `- Údržba, pojištění, daně, správa, marketing\n`;
                prompt += `- Obvykle 15-30% z hrubého příjmu\n`;
                prompt += `- **OVĚŘ** skutečné náklady z podkladů!\n\n`;
                prompt += `**Krok 3 - Net Operating Income (NOI)**:\n`;
                prompt += `NOI = Efektivní příjem - OpEx\n\n`;
                prompt += `**Krok 4 - Kapitalizace**:\n`;
                prompt += `- Použij CBRE prime yields a uprav je:\n`;
                prompt += `  * Praha Prime Office: < 5% (baseline)\n`;
                prompt += `  * Retail: 6-8%\n`;
                prompt += `  * Sklady/Logistika: 6-7%\n`;
                prompt += `  * Regionální: +1-2%\n`;
                prompt += `- Hodnota = NOI / Upravený Yield\n\n`;
                prompt += `### 2. POROVNÁVACÍ METODA (Sekundární)\n`;
                prompt += `**Pro komerční objekty je srovnávací metoda nepodstatná**, nicméně ji stanov, ať máme určitou představu.\n`;
                prompt += `- Najdi minimálně 10 podobných objektů (typ, lokalita, obsazenost)\n`;
                prompt += `- Větší vzorek = vyšší statistická přesnost\n`;
                prompt += `- Cena za m² pronajímatelné plochy\n\n`;

                prompt += `## RED FLAGS\n`;
                prompt += `1. **Kvalita nájemníků**:\n`;
                prompt += `   - Bonita nájemníků (velké firmy vs. malé živnostníky)\n`;
                prompt += `   - Délka smluv (krátké smlouvy = riziko neobsazenosti)\n`;
                prompt += `2. **Koncentrace**:\n`;
                prompt += `   - Jeden dominantní nájemník > 50% příjmů = riziko!\n`;
                prompt += `3. **Neobsazenost**:\n`;
                if (formData.obsazenost && parseInt(formData.obsazenost) < 70) {
                    prompt += `   - **VAROVÁNÍ**: Obsazenost ${formData.obsazenost}% je nízká!\n`;
                }
                prompt += `   - Standardní vacancy rate 5-10%\n`;
                prompt += `4. **Technický stav**:\n`;
                prompt += `   - Odložené investice (CapEx)\n`;
                prompt += `   - Životnost technologií (HVAC, výtahy)\n\n`;
            }

            // Závěrečné instrukce
            prompt += `## ZÁVĚREČNÝ VÝSTUP\n\n`;
            prompt += `Strukturuj svou odpověď následovně:\n\n`;
            prompt += `### 1. SOUHRN NEMOVITOSTI\n`;
            prompt += `- Typ, lokalita, klíčové parametry\n\n`;
            
            prompt += `### 2. TRŽNÍ HODNOTA\n`;
            prompt += `Pro každou použitou metodu:\n`;
            prompt += `- Postup výpočtu (krok za krokem)\n`;
            prompt += `- Použité předpoklady\n`;
            prompt += `- Výsledná hodnota v Kč\n\n`;
            
            prompt += `### 3. POROVNÁNÍ METOD\n`;
            prompt += `- Tabulka výsledků všech metod\n`;
            prompt += `- Odůvodnění, která metoda je nejrelevant nější\n`;
            prompt += `- **Finální tržní hodnota** (s odůvodněním)\n\n`;
            
            prompt += `### 4. ZÁSTAVNÍ HODNOTA\n`;
            prompt += `- Aplikuj bezpečnostní koeficient:\n`;
            prompt += `  * Byty: 0.80 (80% tržní hodnoty)\n`;
            prompt += `  * Rodinné domy: 0.70 (70%)\n`;
            prompt += `  * Pozemky: 0.60 (60%)\n`;
            prompt += `  * Komerční: 0.65-0.75 (podle typu)\n`;
            prompt += `- **Zástavní hodnota pro LTV** = Tržní hodnota × Koeficient\n\n`;
            
            prompt += `### 5. RED FLAGS & RIZIKA\n`;
            prompt += `**KRITICKÉ RIZIKA** (Deal Breakers):\n`;
            prompt += `- Právní vady (služebnosti dožití, exekuce)\n`;
            prompt += `- Technické problémy (špatný stav, nutná sanace)\n`;
            prompt += `- Tržní rizika (nízká likvidita, přecenění)\n\n`;
            
            prompt += `**DOPORUČENÍ PRO VĚŘITELE**:\n`;
            prompt += `- Je nemovitost vhodná jako zástava?\n`;
            prompt += `- Jaké maximální LTV (Loan-to-Value) doporučuješ?\n`;
            prompt += `- Jaké podmínky by měly být splněny před poskytnutím úvěru?\n\n`;
            
            prompt += `### 6. CHYBĚJÍCÍ DOKUMENTY\n`;
            prompt += `Seznam všech dokumentů, které by měly být doplněny pro kompletní ocenění.\n\n`;
            
            prompt += `---\n\n`;
            prompt += `**DŮLEŽITÉ ZÁSADY**:\n`;
            prompt += `1. **Princip opatrnosti**: Vždy volte konzervativnější odhad\n`;
            prompt += `2. **Transparentnost**: Jasně uveď všechny předpoklady\n`;
            prompt += `3. **Konkrétnost**: Používej konkrétní čísla, ne obecné fráze\n`;
            prompt += `4. **Red flags první**: Pokud najdeš fatální riziko, uveď ho hned na začátku\n`;
            prompt += `5. **Všechny částky v CZK**: Používej české koruny jako měnu\n\n`;
            
            prompt += `Začni analýzu NYNÍ.`;

            return prompt;
        }

        function copyPrompt() {
            const promptText = document.getElementById('promptText').textContent;
            navigator.clipboard.writeText(promptText).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = '✓ Zkopírováno!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Chyba při kopírování:', err);
                alert('Text byl zkopírován do schránky');
            });
        }

        function resetGenerator() {
            currentStep = 1;
            propertyType = '';
            selectedInputs = [];
            formData = {};
            document.querySelectorAll('.property-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('step1Next').disabled = true;
            updateStepIndicator();
            showSection(1);
        }

        updateStepIndicator();
    </script>

    <!-- Modal pro chybějící povinná pole -->
    <div class="modal-overlay" id="requiredFieldsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">!</div>
                <div class="modal-title">Vyplňte povinná pole</div>
            </div>
            <div class="modal-body">
                <p>Pro pokračování je nutné vyplnit všechna povinná pole označená hvězdičkou (*).</p>
                <div class="modal-list" id="missingFieldsList"></div>
                <p style="margin-top: 15px; font-size: 14px; color: #64748b;">Doplňte prosím chybějící údaje a zkuste to znovu.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeModal()">Rozumím</button>
            </div>
        </div>
    </div>
</body>
</html>
